
## Loading and preparing the data

The first step is to load and prepare the trade data. This data set was extracted from the Convention on International Trade in Endangered Species of Wild Fauna and Flora (CITES), an international treaty organization tasked with monitoring, reporting, and providing recommendations on the international species trade. 

This data set contains records on every international import or export conducted with species from the CITES lists in 2016. It contains columns identifying the species, the import and export countries, and the amount and characteristics of the goods being traded (which range from live animals to skins and cadavers).

```{r   }
library(data.table)     # Run once per session
library(ggplot2)        # Run once per session
library(dplyr)          # Run once per session
library(igraph)         # Run once per session
library(DT)             # Run once per session
library(shiny)          # Run once per session

# Load data from file comptab_2018-01-29 16_00_comma_separated.csv 
dt.trade <- fread("cleaned_trade_data.csv") 

# Save dt.movie.actor. Next time you can simply call the load function (below)
save(dt.trade, file="trade.RData") 

# Load previously saved dt.trade You can start in this line if you have previously saved these data.
load("trade.RData") 
```

Exploratory Data Analaysis and Data Cleaning 

```{r}
#how many rows does our data set contain 
nrow(dt.trade)

#what are the different columns in our data set
colnames(dt.trade)
```

Network

```{r}
# Set the parameters
dt.trade.country <- dt.trade[reporter_name == "Afghanistan"]
#dt.trade <- dt.trade[year == 2017]

# Set the vertices
all.importers <- dt.trade.country[, list(name=unique(reporter_name), type=TRUE)]
all.exporters <- dt.trade.country[, list(name=unique(partner_name), type=FALSE)]

all.vertices <- rbind(all.importers, all.exporters)

# Create & plot the graph
g1 <- graph.data.frame(dt.trade.country[, list(reporter_name, partner_name)],
      directed=TRUE, vertices=all.vertices)

plot(g, vertex.size = 5, vertex.label.cex = 0.6)


#g2 <- graph.data.frame(dt.trade[, list(reporter_name, partner_name)], directed=FALSE)
#summary(g) 
#plot(g)
```

```{r}

# Define UI --------------------------------------------------------------------

ui <- fluidPage(
  
  sidebarLayout(
    
    # Inputs: Select variables to plot
    sidebarPanel(
      
      # Select country
      selectInput(inputId = "country", 
                  label = "Select Country:",
                  choices = c("ReporterName","PartnerName"), 
                  selected = "ReporterName"),
      
      # Select Trade
      selectInput(inputId = "trader", 
                  label = "Select Imports or Exports:",
                  choices = c("Exports"="ReporterName","Imports"="PartnerName"), 
                  selected = "ReporterName"),
      
      # Select variable for color
      #selectInput(inputId = "___", 
      #            label = "____",
      #            choices = c(),
      #            selected = "___")
      
    ),
          # Set year range
      sliderInput(inputId = "year", 
                  label = "Select Range of Years:", 
                  min = 1988, max = 2021, 
                  value = 2020)
    ),
      # Show data table 
    checkboxInput(inputId = "show_data",
                  label = "Show data table", value = TRUE),
    
    # Output: Show scatterplot
    mainPanel(
      plotOutput(outputId = "scatterplot"),
       # Show data table
  dataTableOutput(outputId = "movestable")

    )
  )


# Define server ----------------------------------------------------------------

server <- function(input, output, session) {
  
  output$scatterplot <- renderPlot({
    ggplot(data = movies, aes_string(x = input$x, y = input$y,
                                     color = ___)) +
      geom_point()
  })
  
  }

# Create a Shiny app object ----------------------------------------------------

shinyApp(ui = ui, server = server)

```

